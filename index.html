<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Kassenbuch – PhysioTraining</title>

<style>
body { font-family: Arial; background:#f5f9fa; margin:0; }
header { background:#fff; padding:20px; border-bottom:4px solid #0b6e7f; display:flex; align-items:center; }
h1 { margin-left:20px; color:#0b6e7f; }
.container { padding:20px; }
input, select, button { padding:8px; margin:5px; }
button { background:#0b6e7f; color:white; border:none; }
table { width:100%; border-collapse:collapse; background:white; margin-top:20px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#0b6e7f; color:white; }
.total { margin-top:20px; font-size:20px; color:#0b6e7f; }
</style>
</head>

<body>

<header>
<h1>Kassenbuch</h1>
</header>

<div class="container">

<select id="currency">
<option value="CHF">CHF (Standard)</option>
<option value="EUR">EUR</option>
</select>

<span id="rateInfo"></span><br>

<input id="eingang" type="number" placeholder="Eingang" step="0.01">
<input id="ausgang" type="number" placeholder="Ausgang" step="0.01">
<input id="bemerkung" placeholder="Bemerkung">

<button onclick="addEntry()">Speichern</button>

<table>
<thead>
<tr>
<th>Datum</th>
<th>Eingang CHF</th>
<th>Ausgang CHF</th>
<th>Bemerkung</th>
<th>Saldo CHF</th>
<th>X</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>

<div class="total">
Kassenbestand: <span id="total">0.00</span> CHF
</div>

</div>

<script>
let entries = JSON.parse(localStorage.getItem("kasse")) || [];
let eurRate = 1;

const eingang = document.getElementById("eingang");
const ausgang = document.getElementById("ausgang");
const bemerkung = document.getElementById("bemerkung");
const currency = document.getElementById("currency");
const rateInfo = document.getElementById("rateInfo");

fetch("https://api.exchangerate.host/latest?base=EUR&symbols=CHF")
.then(r => r.json())
.then(d => {
    eurRate = d.rates.CHF;
    rateInfo.innerText = `1 EUR = ${eurRate.toFixed(4)} CHF`;
})
.catch(() => {
    rateInfo.innerText = "Offline – EUR ohne Umrechnung";
});

function save() {
    localStorage.setItem("kasse", JSON.stringify(entries));
}

function render() {
    let saldo = 0;
    let html = "";
    entries.forEach((e,i)=>{
        saldo += e.eingang - e.ausgang;
        html += `<tr>
        <td>${e.datum}</td>
        <td>${e.eingang.toFixed(2)}</td>
        <td>${e.ausgang.toFixed(2)}</td>
        <td>${e.bemerkung}</td>
        <td>${saldo.toFixed(2)}</td>
        <td><button onclick="removeEntry(${i})">X</button></td>
        </tr>`;
    });
    document.getElementById("table").innerHTML = html;
    document.getElementById("total").innerText = saldo.toFixed(2);
}

function addEntry() {
    let e = parseFloat(eingang.value) || 0;
    let a = parseFloat(ausgang.value) || 0;

    if (currency.value === "EUR") {
        e *= eurRate;
        a *= eurRate;
    }

    entries.push({
        datum: new Date().toLocaleDateString("de-CH"),
        eingang: e,
        ausgang: a,
        bemerkung: bemerkung.value
    });

    save();
    render();
    eingang.value = ausgang.value = bemerkung.value = "";
}

function removeEntry(i) {
    entries.splice(i,1);
    save();
    render();
}

render();
</script>

</body>
</html>
